knitr::opts_chunk$set(echo = TRUE)
library(pacman)
p_load(tidyverse, tidycensus, janitor, sf, pacman)
knitr::opts_chunk$set(echo = TRUE)
library(pacman)
p_load(tidyverse, tidycensus, janitor, sf, pacman)
henn_parcels_raw<-read_csv("C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/Hennepin_County_Parcels_12.4.2021.csv")%>%janitor::clean_names()
mpls_rentals<-read_csv("C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/Active_Rental_Licenses_minneapolis_12.3.2021.csv")%>%janitor::clean_names()
zipco_lu <- read_csv("C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/zipco_lu.csv")
#changing sale year to a date
henn_parcels <- henn_parcels_raw%>%
mutate(sale_date = lubridate::ymd(sale_date))
#change all characters to lowercase
henn_parcels<-henn_parcels%>%
mutate_if(.predicate = is.character, .funs = tolower)
henn_parcels<-henn_parcels%>%
select(pid,
house_no,
street_nm,
condo_no,
mailing_munic_nm,
zip_cd,
owner_nm,
taxpayer_nm,
taxpayer_nm_1,
taxpayer_nm_2,
taxpayer_nm_3,
munic_nm,
build_yr,
sale_date,
sale_price,
sale_code,
tax_tot,
pr_typ_nm1,
hmstd_cd1
)
#change NAs to nothing in character columns
na_to_nothing <- function(x) ifelse(is.na(x),'',x)
#cleans the strings in character columns to be all uppercase, removes whitespace, and removes NAs
henn_parcels<-henn_parcels%>%
mutate_if(.predicate = is.factor, .funs = as.character)%>%
mutate_if(.predicate = is.character,.funs = na_to_nothing)%>%
mutate_if(.predicate = is.character, .funs = trimws)%>%
mutate_if(.predicate = is.character, .funs = toupper)
#clean up the parcel address columns to be simplified to just building number and streetname columns or full address
henn_parcels<-henn_parcels%>%
mutate(address_full = paste(house_no, street_nm,condo_no, mailing_munic_nm, zip_cd, "MN"))%>%
select(-street_nm,
-condo_no)
#clean taxpayer address to get a taxpayer zipcode and taxpayer full address
henn_parcels<-henn_parcels%>%
mutate(tax_address_full = paste(taxpayer_nm_1,taxpayer_nm_2,taxpayer_nm_3),
tax_zip = regmatches(tax_address_full, gregexpr('[0-9]{5}(-[0-9]{4})?(?!.*[0-9]{5}(-[0-9]{4})?)', tax_address_full, perl = TRUE)))%>%
select(-taxpayer_nm_1,
-taxpayer_nm_2,
-taxpayer_nm_3)
# parcel_add<-henn_parcels%>%
#   select(pid,
#          address_full)
#
# tax_add<-henn_parcels%>%
#   select(pid,
#          tax_address_full)
# write_csv(parcel_add, "C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/henn_parcel_add_for_geocoding.12.10.2021.csv")
# write_csv(tax_add, "C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/henn_tax_add_for_geocoding.12.10.2021.csv")
henn_parcels_geocoded<-read_csv("C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/henn_parcel_add_for_geocoding.12.10.2021-geocoded.csv")
henn_parcels_geocoded<-henn_parcels_geocoded%>%
select(pid,
Match_addr,
Longitude,
Latitude,
Postal)%>%
rename(address_full_clean = Match_addr,
parcel_zip = Postal,
parcel_long = Longitude,
parcel_lat = Latitude
)
henn_tax_addr_geocoded<-read_csv("C:/Users/enoble/Box/Landlord Blog/Data/Minneapolis/henn_tax_add_for_geocoding.12.10.2021-geocoded.csv")
henn_tax_addr_geocoded<-henn_tax_addr_geocoded%>%
select(pid,
Match_addr,
Longitude,
Latitude,
Postal)%>%
rename(tax_full_clean = Match_addr,
tax_zip = Postal,
tax_long=Longitude,
tax_lat = Latitude
)
geocoded<-henn_parcels_geocoded%>%
left_join(henn_tax_addr_geocoded, by = c("pid"="pid"))
